name: Manual Dependabot Trigger

on:
  workflow_dispatch:
    inputs:
      package_ecosystem:
        description: 'Dependabot package ecosystem (e.g., "nuget")'
        required: true
        default: 'nuget'
      directory:
        description: 'Directory to scan for dependencies'
        required: true
        default: '/'
      target_branch:
        description: 'Branch to target for updates'
        required: true
        default: 'main'

jobs:
  trigger-dependabot:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Trigger Dependabot update check
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Triggering Dependabot for ecosystem=${{ github.event.inputs.package_ecosystem }} directory=${{ github.event.inputs.directory }} branch=${{ github.event.inputs.target_branch }}"

          RESPONSE=$(curl -sSL -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $GITHUB_TOKEN" \
            "https://api.github.com/repos/${{ github.repository }}/dependabot/updates" \
            -d '{"package_ecosystem":"'"${{ github.event.inputs.package_ecosystem }}"'","directory":"'"${{ github.event.inputs.directory }}"'","target_branch":"'"${{ github.event.inputs.target_branch }}"'"}')

          echo "Response: $RESPONSE"
          echo "$RESPONSE" > dependabot-trigger-response.json

      - name: Upload response
        uses: actions/upload-artifact@v6
        with:
          name: dependabot-response
          path: dependabot-trigger-response.json
